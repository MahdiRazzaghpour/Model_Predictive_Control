clc;
close all;
clear all;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
MC_Transition = [0.890142587791657,0.689005815563556,0.594405594405594,0.560836501901141,0.515418502202643,0.517006802721088,0.392523364485981,0.538461538461538,0.361702127659574,0.270270270270270;0.0741810040065991,0.165605095541401,0.197552447552448,0.197718631178707,0.220264317180617,0.224489795918367,0.233644859813084,0.123076923076923,0.212765957446808,0.243243243243243;0.0190608060334669,0.0720022154527831,0.0970279720279720,0.0969581749049429,0.0925110132158592,0.102040816326531,0.158878504672897,0.0923076923076923,0.148936170212766,0.216216216216216;0.00792481734621725,0.0346164497369150,0.0480769230769231,0.0646387832699620,0.0616740088105726,0.0612244897959183,0.0560747663551402,0.107692307692308,0.0851063829787234,0.108108108108108;0.00350577421635640,0.0160620326779287,0.0218531468531469,0.0247148288973385,0.0176211453744494,0.0136054421768708,0.0373831775700934,0.0461538461538461,0.0425531914893617,0.0270270270270271;0.00223898185246290,0.00913874273054553,0.0148601398601398,0.0133079847908745,0.0528634361233480,0.0204081632653061,0.0373831775700934,0.0153846153846153,0.0212765957446809,0.0540540540540539;0.00138463351402306,0.00443090556632504,0.0113636363636364,0.0171102661596958,0.0176211453744494,0.0204081632653062,0.0186915887850468,0.0307692307692308,0.0425531914893618,0.0270270270270271;0.000707046900777741,0.00498476876211584,0.00524475524475528,0.00950570342205323,0.0132158590308370,0.0204081632653061,0.0186915887850468,0.0153846153846154,0.0212765957446809,0.0270270270270270;0.000559745463115753,0.00249238438105786,0.00349650349650356,0.00760456273764268,0.00440528634361232,0.00680272108843544,0.0373831775700934,0.0153846153846153,0.0425531914893617,0.0270270270270271;0.000294602875324087,0.00166158958737195,0.00611888111888108,0.00760456273764256,0.00440528634361232,0.0136054421768708,0.00934579439252339,0.0153846153846154,0.0212765957446809,0];
mc = dtmc(MC_Transition');
%figure(1);
%graphplot(mc,'ColorEdges',true);
total_step = 10^9;
num_state = 6;

for i=1:num_state
    mc_ipg(:,i) = simulate(mc,total_step);
end

ipg_index=ones(1,num_state);
car_time=ones(1,num_state);

for i=1:total_step
   time = i;
   if car_time(1,1) == time
        s1='1';
        car_time(1,1)= time + mc_ipg(ipg_index(1,1),1);
        ipg_index(1,1)= ipg_index(1,1)+1;
   else
        s1='0';
   end
        
  if car_time(1,2) == time
        s2='1';
        car_time(1,2)= time + mc_ipg(ipg_index(1,2),2);
        ipg_index(1,2)= ipg_index(1,2)+1;
   else
        s2='0';
  end
  
  if car_time(1,3) == time
        s3='1';
        car_time(1,3)= time + mc_ipg(ipg_index(1,3),3);
        ipg_index(1,3)= ipg_index(1,3)+1;
   else
        s3='0';
  end
  
  if car_time(1,4) == time
        s4='1';
        car_time(1,4)= time + mc_ipg(ipg_index(1,4),4);
        ipg_index(1,4)= ipg_index(1,4)+1;
   else
        s4='0';
  end
  
  if car_time(1,5) == time
        s5='1';
        car_time(1,5)= time + mc_ipg(ipg_index(1,5),5);
        ipg_index(1,5)= ipg_index(1,5)+1;
   else
        s5='0';
  end
  
  if car_time(1,6) == time
        s6='1';
        car_time(1,6)= time + mc_ipg(ipg_index(1,6),6);
        ipg_index(1,6)= ipg_index(1,6)+1;
   else
        s6='0';
  end
%   
%   if car_time(1,7) == time
%         s7='1';
%         car_time(1,7)= time + mc_ipg(ipg_index(1,7),7);
%         ipg_index(1,7)= ipg_index(1,7)+1;
%    else
%         s7='0';
%   end
%    
%   if car_time(1,8) == time
%         s8='1';
%         car_time(1,8)= time + mc_ipg(ipg_index(1,8),8);
%         ipg_index(1,8)= ipg_index(1,8)+1;
%    else
%         s8='0';
%   end
%    
%   if car_time(1,9) == time
%         s9='1';
%         car_time(1,9)= time + mc_ipg(ipg_index(1,9),9);
%         ipg_index(1,9)= ipg_index(1,9)+1;
%    else
%         s9='0';
%   end
%    
%   if car_time(1,10) == time
%         s10='1';
%         car_time(1,10)= time + mc_ipg(ipg_index(1,10),10);
%         ipg_index(1,10)= ipg_index(1,10)+1;
%    else
%         s10='0';
%   end
%    
   
   S = strcat(s1,s2,s3,s4,s5,s6);%,s7,s8,s9,s10);
   D(i,1) = bin2dec(S)+1;
end

[f,x] = ecdf(D);  %CDF
for i = 1:size(f,1)-1
    pdf(i,1) = f(i+1,1) - f(i,1);   %calculation the pdf
end

figure(2)
stem(x(2:end),pdf);

Connectivity_value = unique(D);

for k=1:size(Connectivity_value,1)
    N=1;  %counter
        for i=1:size(D,1)-1
            if (D(i,1)== Connectivity_value(k,1))
                next_Connectivity(k,N) = D(i+1,1);
                N=N+1;
            end
        end
end

for k=1:size(next_Connectivity,1)
    temp1 = next_Connectivity(k,:);
    temp = temp1(temp1>0);
    if isempty(temp) ~= 1
        [f1,x1] = ecdf(temp);
            for i = 1:size(f1,1)-1
                Transition_Probability(i,k) = f1(i+1,1) - f1(i,1);  %calculating the transition probabilities
            end
    end
end